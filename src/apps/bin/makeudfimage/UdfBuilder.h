//----------------------------------------------------------------------
//  This software is part of the OpenBeOS distribution and is covered 
//  by the OpenBeOS license.
//
//  Copyright (c) 2003 Tyler Dauwalder, tyler@dauwalder.net
//----------------------------------------------------------------------

/*! \file UdfBuilder.h

	Main UDF image building class interface declarations.
*/

#ifndef _UDF_BUILDER_H
#define _UDF_BUILDER_H

#include <stdarg.h>
#include <string>
#include <SupportDefs.h>

#include "Allocator.h"
#include "OutputFile.h"
#include "ProgressListener.h"
#include "UdfString.h"

class UdfBuilder {
public:
	UdfBuilder(const char *outputFile, uint32 blockSize, bool doUdf,
	           bool doIso, const char *udfVolumeName, const char *isoVolumeName,
	           const ProgressListener &listener);
	status_t InitCheck() const;
	status_t Build();
private:
	//! Maximum length of string generated by calls to any _Print*() functions
	static const int kMaxUpdateStringLength = 1024;

	OutputFile& _OutputFile() { return fOutputFile; }
	uint32 _BlockSize() const { return fBlockSize; }	
	uint32 _BlockShift() const { return fBlockShift; }	
	bool _DoUdf() const { return fDoUdf; }
	bool _DoIso() const { return fDoIso; }
	Udf::String& _UdfVolumeName() { return fUdfVolumeName; }
	Udf::String& _IsoVolumeName() { return fIsoVolumeName; }
	Allocator& _Allocator() { return fAllocator; }
	time_t _BuildTime() const { return fBuildTime; }
	Udf::timestamp& _BuildTimeStamp() { return fBuildTimeStamp; }

	void _SetBuildTime(time_t time);

	status_t _FormatString(char *message, const char *formatString, va_list arguments) const;
	void _PrintError(const char *formatString, ...) const;
	void _PrintWarning(const char *formatString, ...) const;
	void _PrintUpdate(VerbosityLevel level, const char *formatString, ...) const;

	status_t fInitStatus;
	OutputFile fOutputFile;
	string fOutputFilename;
	uint32 fBlockSize;
	uint32 fBlockShift;
	bool fDoUdf;
	bool fDoIso;
	Udf::String fUdfVolumeName;
	Udf::String fIsoVolumeName;
	const ProgressListener &fListener;
	Allocator fAllocator;
	time_t fBuildTime;
	Udf::timestamp fBuildTimeStamp;
};


#endif	// _UDF_BUILDER_H
