SubDir OBOS_TOP src kits ;

# If defined allows to run applications without the registrar
# -- for development only, of course.
if $(RUN_WITHOUT_REGISTRAR) {
	local defines = [ FDefines RUN_WITHOUT_REGISTRAR ] ;
	SubDirCcFlags $(defines) ;
	SubDirC++Flags $(defines) ;
}

# If defined allows to run applications without the app server
# -- needed until the app server runs on our kernel.
RUN_WITHOUT_APP_SERVER ?= 0 ;
if $(RUN_WITHOUT_APP_SERVER) != 0 {
	local defines = [ FDefines RUN_WITHOUT_APP_SERVER ] ;
	SubDirCcFlags $(defines) ;
	SubDirC++Flags $(defines) ;
}

UsePrivateHeaders [ FDirName kernel util ] ;  # For KMessage.h
UsePrivateHeaders syslog_daemon ;             # For syslog.cpp

# Build our libbe.so

AddResources libbe.so : libbe_version.rdef ;

SharedLibrary be :
	KMessage.cpp
	: 
	<libbe>app_kit.o
	<libbe>interface_kit.o
	<libbe>storage_kit.o
	<libbe>storage_diskdevice_kit.o
	<libbe>support_kit.o

	libroot.so	# make sure it links against our libroot.so
	stdc++.r4
;

MakeLocate <develop>libbe.so : $(OBOS_STLIB_DIR) ;
RelSymLink <develop>libbe.so : libbe.so ;

# Build libopenbeos.so

SharedLibrary openbeos :
	KMessage.cpp
	syslog.cpp
	:
	<libbe>app_kit.o
	<libbe>interface_kit.o
	<libbe>storage_kit.o
	<libbe>support_kit.o

	libbeadapter.so
	net
	stdc++.r4
;

SEARCH on [ FGristFiles KMessage.cpp ]
	= [ FDirName $(OBOS_TOP) src system kernel messaging ] ;

SEARCH on [ FGristFiles syslog.cpp ]
	= [ FDirName $(OBOS_TOP) src system libroot posix ] ;

# Note: If you want to use /boot/home/config/lib/libopenbeos.so in another
# rule, use the identifier <boot!home!config!lib>libopenbeos.so, otherwise
# libopenbeos.so.

LOCATE on <boot!home!config!lib>libopenbeos.so
		  <boot!home!config!lib>libbeadapter.so = /boot/home/config/lib ;
File <boot!home!config!lib>libopenbeos.so : libopenbeos.so ;
File <boot!home!config!lib>libbeadapter.so : libbeadapter.so ;
Includes <boot!home!config!lib>libopenbeos.so
	: <boot!home!config!lib>libbeadapter.so ;

SubInclude OBOS_TOP src kits app ;
SubInclude OBOS_TOP src kits debug ;
SubInclude OBOS_TOP src kits device ;
SubInclude OBOS_TOP src kits game ;
SubInclude OBOS_TOP src kits interface ;
SubInclude OBOS_TOP src kits mail ;
SubInclude OBOS_TOP src kits media ;
SubInclude OBOS_TOP src kits midi ;
SubInclude OBOS_TOP src kits midi2 ;
SubInclude OBOS_TOP src kits network ;
SubInclude OBOS_TOP src kits opengl ;
SubInclude OBOS_TOP src kits screensaver ;
SubInclude OBOS_TOP src kits storage ;
SubInclude OBOS_TOP src kits support ;
SubInclude OBOS_TOP src kits textencoding ;
SubInclude OBOS_TOP src kits tracker ;
SubInclude OBOS_TOP src kits translation ;
