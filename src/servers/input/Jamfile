SubDir OBOS_TOP src servers input ;

if $(COMPILE_FOR_R5) {
	SubDirC++Flags -DCOMPILE_FOR_R5 ;
}

rule MkKeymapHeader
{
	local binary = $(1) ;
	local source = $(2) ;

	SetupObjectsDir ;

	SEARCH on $(source) = $(SEARCH_SOURCE) ;
	MakeLocate $(binary) : $(LOCATE_TARGET) ;

	Depends $(binary) : $(source) keymap ;
	MkKeymapHeader1 $(binary) : keymap $(source) ;
	LocalClean clean : $(binary) ;
}

actions MkKeymapHeader1
{
	$(2[1]) -o "$(1)" -h "$(2[2-])" ;
}

MkKeymapHeader [ FGristFiles SystemKeymap.cpp ] : US-International.keymap ;

SEARCH on US-International.keymap
	  += [ FDirName $(SUBDIR) $(DOTDOT) $(DOTDOT) data etc keymaps ] ;

AddResources input_server : input_server.rdef ;

UsePrivateHeaders app ;
UsePrivateHeaders input ;
UsePrivateHeaders interface ;
UsePrivateHeaders storage ;


SubDirC++Flags -DADD_ON_STABLE_SECONDS=1 ;	# for AddOnMonitorHandler.cpp
if $(TARGET_PLATFORM) != haiku {
	SubDirC++Flags -DCOMPILE_FOR_R5 ;
	#APPSERVER_TEST_MODE = 1 ;
	if $(APPSERVER_TEST_MODE) {
		SubDirC++Flags -DAPPSERVER_TEST_MODE ;
	} else {
		SubDirC++Flags -DAPPSERVER_R5_COMM ;
	}
} else {
	APPSERVER_TEST_MODE = 1 ;
}

Server input_server :
	InputServer.cpp
	InputServerDevice.cpp
	InputServerFilter.cpp
	InputServerMethod.cpp

	AddOnManager.cpp
	DeviceManager.cpp

	MouseSettings.cpp
	KeyboardSettings.cpp

	SystemKeymap.cpp

	MethodReplicant.cpp
	MethodMenuItem.cpp
	BottomlineWindow.cpp

	# storage
	AddOnMonitor.cpp
	AddOnMonitorHandler.cpp
	NodeMonitorHandler.cpp

	: stdc++.r4
;

if $(TARGET_PLATFORM) = haiku {
        # link for Haiku

        LinkSharedOSLibs input_server :
                libroot.so libbe.so ;

} else {
        # link as test application under R5

        LinkSharedOSLibs input_server :
                be ;
	if $(APPSERVER_TEST_MODE) {
		LinkSharedOSLibs input_server :
                <boot!home!config!lib>libopenbeos.so ;
	}
}


SEARCH on [ FGristFiles AddOnMonitor.cpp
	AddOnMonitorHandler.cpp
	NodeMonitorHandler.cpp ] += [ FDirName $(SUBDIR) $(DOTDOT) $(DOTDOT) kits storage ] ;

Package haiku-inputkit-cvs :
        input_server :
        boot beos system servers ;

Packages haiku-inputkit-cvs :
        README LICENSE install.sh ;
