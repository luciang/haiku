SubDir OBOS_TOP src servers input ;

rule MkKeymapHeader
{
	local binary = $(1) ;
	local source = $(2) ;

	SetupObjectsDir ;

	SEARCH on $(source) = $(SEARCH_SOURCE) ;
	MakeLocate $(binary) : $(LOCATE_TARGET) ;

	Depends $(binary) : $(source) keymap ;
	MkKeymapHeader1 $(binary) : keymap $(source) ;
	LocalClean clean : $(binary) ;
}

actions MkKeymapHeader1
{
	$(2[1]) -o "$(1)" -h "$(2[2-])" ;
}

MkKeymapHeader [ FGristFiles SystemKeymap.cpp ] : US-International.keymap ;

SEARCH on US-International.keymap
	  += [ FDirName $(SUBDIR) $(DOTDOT) $(DOTDOT) apps bin keymap ] ;

if $(COMPILE_FOR_R5) {
	SubDirC++Flags -DCOMPILE_FOR_R5 ;
}

AddResources input_server : input_server.rdef ;

UsePrivateHeaders app ;
UsePrivateHeaders input ;
UsePrivateHeaders storage ;

Server input_server :
	InputServer.cpp
	InputServerDevice.cpp
	InputServerFilter.cpp
	InputServerMethod.cpp

	AddOnManager.cpp
	DeviceManager.cpp

	MouseSettings.cpp
	KeyboardSettings.cpp

	SystemKeymap.cpp

	# storage
	AddOnMonitor.cpp
	AddOnMonitorHandler.cpp
	NodeMonitorHandler.cpp

	: be
;

if $(COMPILE_FOR_R5) {
} else {
	LinkSharedOSLibs input_server : <boot!home!config!lib>libopenbeos.so ;
}

SEARCH on [ FGristFiles AddOnMonitor.cpp
	AddOnMonitorHandler.cpp
	NodeMonitorHandler.cpp ] += [ FDirName $(SUBDIR) $(DOTDOT) $(DOTDOT) kits storage ] ;
