SubDir HAIKU_TOP src add-ons media plugins avcodec libavcodec ppc ;

SubDirHdrs [ FDirName $(SUBDIR) .. ] ;
SubDirHdrs [ FDirName $(SUBDIR) ../.. ] ;
SubDirHdrs [ FDirName $(SUBDIR) ../../libavutil ] ;
SubDirHdrs [ FDirName $(SUBDIR) ../../libswscale ] ;

# filter warnings we don't want here
TARGET_WARNING_CCFLAGS = [ FFilter $(TARGET_WARNING_CCFLAGS)
	: -Wall -Wmissing-prototypes -Wsign-compare -Wpointer-arith ] ;

if $(HAIKU_GCC_VERSION[1]) >= 3 {
	SubDirCcFlags -fomit-frame-pointer -fno-pic ;
} else {
	SubDirCcFlags -fomit-frame-pointer -DPIC ;
}

# Enable altivec support
SubDirCcFlags -faltivec -maltivec -mabi=altivec ;

local defines ;
defines = HAVE_AV_CONFIG_H=1 ;
defines += ARCH_X86=0 ARCH_X86_32=0 ARCH_PPC=1 ARCH_SPARC=0 ;
defines += HAVE_AMD3DNOW=0 HAVE_AMD3DNOWEXT=0 ;
defines += HAVE_MMX=0 HAVE_MMX2=0 HAVE_SSE=0 HAVE_SSE3=0 ; 
defines += HAVE_ALTIVEC=1 HAVE_ALTIVEC_H=0 ;
defines += HAVE_VIS=0 ;

defines = [ FDefines $(defines) ] ;
SubDirCcFlags $(defines) ;
SubDirC++Flags $(defines) ;


StaticLibrary libavcodec_ppc.a :
	check_altivec.c
    float_altivec.c
    int_altivec.c
	dsputil_altivec.c
	dsputil_ppc.c
    fdct_altivec.c
    fft_altivec.c
    idct_altivec.c
    gmc_altivec.c
    imgresample_altivec.c
    h264_altivec.c
#   h264_template_altivec.c
    mpegvideo_altivec.c
    vc1dsp_altivec.c
    snow_altivec.c
;

