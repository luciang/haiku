SubDir OBOS_TOP src add-ons kernel file_systems udf ;

# save original optimization level
oldOPTIM = $(OPTIM) ;

# set some additional defines
{
	local defines =
		KEEP_WRONG_DIRENT_RECLEN
		;

	if $(COMPILE_FOR_R5) {
		defines += COMPILE_FOR_R5 ;
	}

	if $(DEBUG) {
		#defines += DEBUG ;
	} else {
		# the gcc on BeOS doesn't compile BFS correctly with -O2 or more
		OPTIM = -O1 ;
	}

	defines = [ FDefines $(defines) ] ;
	SubDirCcFlags $(defines) -Wall -Wno-multichar ;
	SubDirC++Flags $(defines) -Wall -Wno-multichar ;
}

R5KernelAddon udf : [ FDirName kernel file_systems udf ] :
	cpp.cpp
	vfs_interface.cpp

	UdfDebug.cpp
	DiskStructures.cpp
	Volume.cpp
;
LinkSharedOSLibs udf : /boot/beos/system/lib/libroot.so ;

rule InstallUDF
{
	Depends $(<) : $(>) ;
}

actions ignore InstallUDF
{
	cp $(>) /boot/home/config/add-ons/kernel/file_systems/
}

InstallUDF install : udf ;

# restore original optimization level
OPTIM = $(oldOPTIM) ;
