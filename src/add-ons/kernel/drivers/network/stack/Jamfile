SubDir OBOS_TOP src add-ons kernel drivers network stack ;

UsePrivateHeaders net ;

# a) Userland stack version:

R5KernelAddon net_server_driver : kernel drivers bin :
	net_server_driver.c
;

# For OpenBeOS we should be building the driver objects this way.
#KernelObjects
#	net_server_driver.c
#	:
#	-fno-pic -D_KERNEL_MODE
#	;

# b) Kernelland stack version:

R5KernelAddon net_stack_driver : kernel drivers bin :
	net_stack_driver.c
;

# For OpenBeOS we should be building the kernel stack driver objects this way.
#KernelObjects
#	net_stack_driver.c
#	:
#	-fno-pic -D_KERNEL_MODE
#	;

# Link driver(s) to kernel/drivers/dev/net
{
	local dir = [ FDirName $(OBOS_ADDON_DIR) kernel drivers dev net ] ;

	local instDriver = <kernel!drivers!dev!net>net_stack_driver ;
	MakeLocate $(instDriver) : $(dir) ;
	RelSymLink $(instDriver) : net_stack_driver ;

	local instDriver = <kernel!drivers!dev!net>net_server_driver ;
	MakeLocate $(instDriver) : $(dir) ;
	RelSymLink $(instDriver) : net_server_driver ;
}

# Installation

OBOSInstall install-networking : /boot/home/config/add-ons/kernel/drivers/bin	: 
	net_server_driver 
	net_stack_driver 
;

OBOSInstallRelSymLink install-networking : /boot/home/config/add-ons/kernel/drivers/dev/net : 
	<installed>net_server_driver 
	<installed>net_stack_driver	: 
	installed-symlink 
;

Package openbeos-networkingkit-cvs :
	net_stack_driver net_server_driver :
	boot home config add-ons kernel drivers bin ;

Package openbeos-networkingkit-cvs :
	<kernel!drivers!dev!net>net_stack_driver :
	boot home config add-ons kernel drivers dev net ;

Package openbeos-networkingkit-cvs :
	<kernel!drivers!dev!net>net_server_driver :
	boot home config add-ons kernel drivers dev net ;
