SubDir HAIKU_TOP src system kernel ;

{
	# TODO: Rename the macro OBOS_ARCH to TARGET_ARCH, or something like that.
	local defines =
		OBOS_ARCH=\\\"$(TARGET_ARCH)\\\"
		;

	defines = [ FDefines $(defines) ] ;
	SubDirCcFlags $(defines) ;
	SubDirC++Flags $(defines) ;
}

KernelMergeObject kernel_core.o :
	boot_item.cpp
	cpu.c
	elf.c
	heap.c
	image.c
	int.c
	kernel_daemon.c
	linkhack.c
	lock.c
	main.c
	module.c
	port.c
	real_time_clock.c
	scheduler.c
	sem.c
	shutdown.c
	signal.c
	system_info.c
	smp.c
	syscalls.c
	sysctl.c
	team.c
	thread.c
	timer.c

	: -fno-pic
	;

# We need to specify the dependency on the generated syscalls files explicitly.
Includes [ FGristFiles syscalls.c ]
	: <syscalls>syscall_dispatcher.h <syscalls>syscall_table.h ;

KernelLd linkhack.so :
	<$(SOURCE_GRIST)>linkhack.o
	:
	:
	-shared -Bdynamic
	;

SubInclude HAIKU_TOP src system kernel arch ;
SubInclude HAIKU_TOP src system kernel cache ;
SubInclude HAIKU_TOP src system kernel device_manager ;
SubInclude HAIKU_TOP src system kernel debug ;
SubInclude HAIKU_TOP src system kernel disk_device_manager ;
SubInclude HAIKU_TOP src system kernel fs ;
SubInclude HAIKU_TOP src system kernel messaging ;
SubInclude HAIKU_TOP src system kernel util ;
SubInclude HAIKU_TOP src system kernel vm ;
